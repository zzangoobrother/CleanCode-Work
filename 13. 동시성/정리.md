## 1. 동시성 프로그래밍이란?
어플리케이션을 효율적으로 실행하기 위해 멀티코어를 온전히 활용하도록 구현하는 방식

#### 이해하기
- 동시성이 구현되지 않은 경우
서버가 클라이언트의 요청이 완료되도록 그저 기다릭 때문에 다른 작업이 실행되지 못한다.

- 병렬성으로 구현한 경우
서버의 수가 늘어 났지만, 요청을 처리할 때까지 기다리기 때문에 다른 작업이 수행되지 못한다.

- 동시성을 구현한 경우
언어 레벨에서 하드웨어의 멀티코어를 적절하게 사용하도록 지원하기 때문에 동시성만 신경써서 개발하면 된다.
서버를 효율적으로 사용하여 처리량을 최대화한다.

## 2. 동시성 프로그래밍이 필요한 이유
#### 동시성 프로그래밍 오해
1. 동시성은 항상 성능을 높여준다 -> 동시성은 때로 성능을 높여준다.
![servlet1](https://user-images.githubusercontent.com/42162127/144751012-632b0378-22c2-43a8-b197-6d8ea3cd086b.png)
![servlet2](https://user-images.githubusercontent.com/42162127/144751044-0b2b4ca6-b363-4549-b04a-c74c77e049c7.png)

- 요청이 들어오면 Thread Pool에 있는 Thread가 서블릿의 service() 메서드를 호출한다.
- service의 doGet(), doPost()에서 요청에 대한 처리를 하도록 구현한다.

2. 동시성을 구현해도 설계는 변하지 않는다. -> 동시성을 구현하면 설계를 바꿔야 한다.
- 단일 스레드 시스템과 다중 스레드 시스템은 설계가 다르다.
- '무엇'과 '언제'를 분리하면 시스템의 구조가 크게 달라진다.

3. Web이나 EJB와 같은 컨테이너를 사용한다면 동시성을 이해할 필요가 없다 -> 컨테이너를 사용해도 동시성을 이해해야 한다.
- 컨테이너를 통해 멀티 쓰레드를 사용하는 것이기 때문에 컨테이너의 동작을 이해해야 한다.
- 동시 수정, 데드락 같은 문제를 피할 수 있는지를 알아야 한다.

## 3. 안전한 동시성 프로그래밍 규칙
1. 단일 책임 원칙 설계
- 동시성 관련 코드는 다른 코드와 분리하라

2. 자료 범위를 제한하라
- 공유 자료를 최대한 줄여라
- 임계 영역의 수를 최소화 해야 한다.

3. 자료 사본을 사용하라
- 공유자료를 줄이려면, 최대한 공유하지 않는 방법이 좋다.
- 객체를 복사해 읽기 전용으로 사용한다.
4. Thread는 가능한 독립적으로 구현하라.
- 다른 스레드와 자료를 공유하지 않는다.

5. 동기화하는 메서드 사이에 존재하는 의존성을 이해하라
- 공유 객체 하나에는 메서드 하나만 사용하라
- 클라이언트에서 잠금 -> 클라이언트에서 첫 번째 메서드를 호출하기 전에 서버를 잠근다. 마지막 메서드를 호출할 때까지 잠금을 유지한다.
- 서버에서 잠금 -> 서버에다 "서버를 잠그고 모든 메서드를 호출한 후 자금을 해제하는" 메서드를 구현한다.
- 연결 서버 -> 잠금을 수행하는 중간 단게를 생성한다.

## 4. 동시성 테스트 방법
1. 동시성 코드를 테스트 해야 한다.
- 테스트를 했다고 동시성 코드가 100% 올바르다고 증명하기는 불가능하다. 하지만 충분한 테스트는 위험을 낮춘다.

2. 코드에 보조 코드를 넣어 돌려라
- 드물게 발생하는 오류를 자주 발생시키도록 보조 코드를 추가한다.

3. 동시성 코드를 실제 환경이나 테스트 환경에서 돌려본다.
- 다양한 요청과 상황에 동시성 코드가 정상적으로 동작하는지 확인한다.
